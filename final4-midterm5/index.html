<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Final and Midterm Makeup Exam 2023</title>
    <link
      rel="stylesheet"
      href="//stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
      integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="//stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css"
      integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ"
      crossorigin="anonymous"
    />
    <style>
      .panel {
        min-height: 390px;
      }
    </style>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/jquery.dataTables.min.css"
      integrity="sha512-1k7mWiTNoyx2XtmI96o+hdjP8nn0f3Z2N4oF/9ZZRgijyV4omsKOXEnqL1gKQNPy2MTSP9rIEWGcH/CInulptA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- ✅ load jQuery ✅ -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <!-- ✅ load DataTables ✅ -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"
      integrity="sha512-BkpSL20WETFylMrcirBahHfSnY++H2O1W+UnEEO4yNIl+jI2+zowyoGJpbtk6bx97fBXf++WJHSSK2MV4ghPcg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle collapsed"
            data-toggle="collapse"
            data-target="#navbar"
            aria-expanded="false"
            aria-controls="navbar"
          >
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Midterm Exam</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container theme-showcase" role="main">
      <div class="jumbotron">
        <h1>
          Welcome to Final and Midterm Makeup Exam at course Introduction to Web
          Programming
        </h1>
        <p>
          This is skeleton project to save you time on exam. You have to
          populate missing snippet codes to make this project functional
        </p>

        <h3>
          Following parts should be completed after complemetition of all exams
          that you are going to submit
        </h3>
        <ul>
          <li>
            1. Zip your code and upload to LMS quiz assignment.
          </li>
        </ul>
        <h3>Following parts should be completed for MIDTERM MAKEUP</h3>
        <ul>
          <li>
            1. Create midterm-exam database with one table named locations
          </li>
          <li>
            2. Connection to MySQL database in rest/dao/BaseDao.php file per
            TODO instructions in the file
          </li>
          <li>
            3. REST endpoint rest/midterm/connection-check in
            rest/routes/MidtermRoutes.php file per TODO instructions in the file
            (optional and not graded)
          </li>
          <li>
            4. REST endpoint rest/midterm/input_data in
            rest/routes/MidtermRoutes.php file per TODO instructions in the file
          </li>
          <li>
            5. REST endpoint rest/midterm/regions/@country in
            rest/routes/MidtermRoutes.php file per TODO instructions in the file
          </li>
          <li>
            6. REST endpoint rest/midterm/initial_letter_distributions in
            rest/routes/MidtermRoutes.php file per TODO instructions in the file
          </li>
          <li>
            7. REST endpoint rest/midterm/cities/@country in rest/routes/MidtermRoutes.php
            file per TODO instructions in the file
          </li>
          <li>
            8. Service method input_data in rest/services/MidtermService.php
            file
          </li>
          <li>
            9. Service method regions in rest/services/MidtermService.php file
          </li>
          <li>
            10. Service method initial_letter_distributions in rest/services/MidtermService.php file
          </li>
          <li>
            11. Service method cities in rest/services/MidtermService.php file
          </li>
          <li>
            12. DAO method input_data in rest/dao/MidtermDao.php file
          </li>
          <li>
            13. DAO method regions in rest/dao/MidtermDao.php file
          </li>
          <li>
            14. DAO method initial_letter_distributions in rest/dao/MidtermDao.php file
          </li>
          <li>
            15. DAO method cities in rest/dao/MidtermDao.php file
          </li>
        </ul>

        <h3>Following parts should be completed for FINAL</h3>
        <ul>
          <li>
            1. Implement TODO #1 in index.html
          </li>
          <li>
            2. Implement TODO #2 in index.html
          </li>
          <li>
            3. Implement TODO #3 in index.html
          </li>
          <li>
            4. Implement TODO #4 in index.html
          </li>
          <li>
            5. Implement TODO #4 in index.html
          </li>
        </ul>
      </div>
      <div></div>
    </div>

    <div>
      Dropdown list of unique countries:
      <select id = "dropdown"  onchange = "selectOption()">
        
     </select>
     <br><br>
    </div>

    <div>
      Dropdown list of regions in selected country:
      <select id = "regionsDropdown"  onchange = "selectRegion()">
        
     </select>     
     <br><br>
    </div>


    <div>
      <table id="locations", class="display", style="width: 100%;">
        <thead>
          <tr>
            <th>City</th>
            <th>City Count</th>
            <th>Country Code</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>


    <div>
      <table id="chartContainer", style="width: 90%;">
        <thead>
          <tr>
            <th>A</th>
            <th>B</th>
            <th>C</th>
            <th>D</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>

  </body>

  <script>
    /*TODO #1
     * Load content from IP2LOCATION.json file
     * 5 points
     */

    $.getJSON("IP2LOCATION.json", function(data) {

      console.log(data);
      
      
        /*TODO #5
        * Create pie chart that shows distribution of how many countries starts with letters A, B, C and D
        * Show number of occurrences at the beginning of country name for each of these (A, B, C and D) letters for countries in the file
        * 24 points
        */

        var countriesA = 0;
        var countriesB = 0;
        var countriesC = 0;
        var countriesD = 0;

        for(let i = 0; i < data.length; i++) {

          if(data[i].Country.startsWith('A') )
            countriesA += 1;
          else if(data[i].Country.startsWith('B') )
            countriesB += 1;
          else if(data[i].Country.startsWith('C') )
            countriesC += 1;
          else if(data[i].Country.startsWith('D') )
            countriesD += 1;

        }
        
        const chartData = [];
        //let temp = [countriesA, countriesB, countriesC, countriesD];
        chartData.push(countriesA);
        chartData.push(countriesB);
        chartData.push(countriesC);
        chartData.push(countriesD);
          
          console.log(chartData);

          Highcharts.chart('chartContainer', {
          chart: {
            type: 'pie'
          },
          title: {
            text: 'Distribution of Countries'
          },
          xAxis: {
            type: 'category'
          },
          yAxis: {
            title: {
              text: ''
            }
          },
          series: [{
            name: '',
            data: chartData
          }]
        });



      /*TODO #2
     * Create select dropdown and load unique countries from file within it
     * -> unique means that one country appears only once
     * You can use select2 library if you want
     * 24 points
     */

     //get a list of unique countries
     const countries = [];
      for(let i = 0; i < data.length; i++) {

        if(!countries.includes(data[i].Country)) {
          countries.push(data[i].Country);
        }

      }
      console.log(countries);

      //dropdown
      const select = $("#dropdown");
      for (let i = 0; i < countries.length; i++) {
        let option = `<option value="${countries[i]}">${countries[i]}</option>`;
        select.append(option);
      } 

    })

    function selectOption() {
      var selectedValue = dropdown.options[dropdown.selectedIndex].text;
      console.log(selectedValue);

      /*TODO #3
      * Create select dropdown and load unique regions from file within that dropdown for the country SELECTED in country dropdown
      * -> unique means that one regions appears only once
      * You can use select2 library if you want
      * 24 points
      */

      $.getJSON("IP2LOCATION.json", function(data) { 
        const regions = [];
        regions.push('-');
        for(let i = 0; i < data.length; i++) {

          if(selectedValue == data[i].Country) {
            if(!regions.includes(data[i].Region)) {
              regions.push(data[i].Region);
            }       

          }
        }
        console.log(regions);

        //dropdown
        const select = $("#regionsDropdown");
        for (let i = 0; i < regions.length; i++) {
          let option = `<option value="${regions[i]}">${regions[i]}</option>`;
          select.append(option);
        } 

      })
    }
    
    function selectRegion() {
      var selectedRegion = regionsDropdown.options[regionsDropdown.selectedIndex].text;
      console.log(selectedRegion);
 

      /*TODO #4
      * Use jQuery Datatable library to create HTML table with id = locations
      * This table will list only unique cities from the region selected in select dropdown:
      * together with total number of occurrences of that city available in file and
      * country code
      * -> unique means that one city appears only once
      * 24 points
      */

      $.getJSON("IP2LOCATION.json", function(data) { 

        const cities = [];
        var cityCount = [];
        var countryCode = [];
        for(let i = 0; i < data.length; i++) {

          if(selectedRegion == data[i].Region) {
            if(!cities.includes(data[i].City)) {
              cities.push(data[i].City);
              countryCode.push(data[i].code);
              cityCount[cities.indexOf(data[i].City)] = 1;
            }
            else {
              cityCount[cities.indexOf(data[i].City)] += 1;
            }
          }       

        }
        console.log(cities);

        const tableData = [];
        for(let i = 0; i < cities.length; i++) {
          let temp = [cities[i], cityCount[i], countryCode[i]];
          tableData.push(temp);
        }
        console.log(tableData);


        //datatable
        $('#locations').DataTable( {
        data: tableData,
        paging: true,
        searching: true,
        ordering: true,
        columns: [
          { title: "City" },
          { title: "Count" },
          { title: "Code" }
        ],
        "pageLength": 5,
        "lengthMenu":  [2, 5, 10, 25, 50, "All"]
      })


      })

    }
    

  </script>
</html>
